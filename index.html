<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Percently — Quick percentage calculator</title>
  <meta name="description" content="Percently: quick, accurate percentage calculations — large, readable inputs and clear labels." />
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="favicon.ico">
  <!-- Inline tiny transparent favicon to avoid 404 when favicon.ico is missing -->
  <link rel="icon" href="data:image/x-icon;utf8,AAABAAEAICAAAAEAIACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A" />
</head>
<body>
  <main class="wrap compact">
    <header class="site-header compact-header">
      <h1 class="title">Percently</h1>
      <p class="subtitle">Readable inputs and clear inline results — large inputs with immediate inline answer.</p>
    </header>

    <section class="compact-card" aria-label="Calculator">
      <form id="calc-form" class="compact-form" novalidate>
        <!-- Mode title + subtitle -->
        <div id="calc-mode" class="calc-mode" aria-live="polite">
          <h2 id="calc-mode-title" class="calc-mode-title">X of Y</h2>
          <p id="calc-mode-sub" class="calc-mode-sub">Enter inputs to compute quickly — result shown on the right.</p>
        </div>

        <!-- Split rectangle: left = stacked inputs, right = result with title -->
        <div class="split-rect" role="group" aria-label="Inputs and result">
          <div class="left-col" role="region" aria-label="Inputs">
            <div class="input-wrap">
              <div class="input-caption" id="label-x-text">Input X</div>
              <label class="big-input big-input-top">
                <input id="input-x" name="x" type="text" inputmode="decimal" placeholder="50" aria-label="X">
              </label>
            </div>
            <div class="input-wrap">
              <div class="input-caption" id="label-y-text">Input Y</div>
              <label class="big-input big-input-bottom">
                <input id="input-y" name="y" type="text" inputmode="decimal" placeholder="200" aria-label="Y">
              </label>
            </div>
          </div>
          <div class="right-col" role="region" aria-label="Result">
            <div class="input-caption" id="label-result-text">Result</div>
            <div class="eq-row" aria-hidden="true">
              <div class="equals" id="equals">=</div>
              <div id="result" class="result-inline" aria-live="polite" title=""></div>
            </div>
            <div id="result-msg" class="result-msg" aria-live="polite"></div>
          </div>
        </div>

        <!-- Actions (below the main rectangle) - centered -->
        <div class="actions-below">
          <button type="submit" id="calculate" class="bar-btn primary" aria-label="Calculate">Calculate</button>
          <button type="button" id="clear" class="bar-btn secondary" aria-label="Clear">Clear</button>
        </div>

        <!-- Calculation options inside the same card (boxed row) - centered -->
        <fieldset class="options-row boxed" role="radiogroup" aria-label="Select calculation" id="options-row">
          <legend class="sr-only">Calculation type</legend>
          <input type="radio" id="opt-percent-of" name="calc" value="percent-of" checked>
          <label for="opt-percent-of" class="option-card">X of Y</label>
          <input type="radio" id="opt-increase-by" name="calc" value="increase-by">
          <label for="opt-increase-by" class="option-card">Increase Y by X</label>
          <input type="radio" id="opt-decrease-by" name="calc" value="decrease-by">
          <label for="opt-decrease-by" class="option-card">Decrease Y by X</label>
          <input type="radio" id="opt-percent-diff" name="calc" value="percent-diff">
          <label for="opt-percent-diff" class="option-card">Percent difference</label>
          <input type="radio" id="opt-what-percent" name="calc" value="what-percent">
          <label for="opt-what-percent" class="option-card">What percent is X of Y</label>
        </fieldset>
      </form>
    </section>

    <footer class="site-footer compact-footer">
      <small>Built with ♥ — responsive & accessible</small>
    </footer>
  </main>
  <script type="module" src="main.js"></script>
  <script>
    // Enforce two-decimal display on #result without changing main.js
    (function(){
      const resultEl = document.getElementById('result');
      if (!resultEl) return;

      function formatAndSet(text) {
        // If text already contains a percent sign, handle separately
        const hasPercent = /%\s*$/.test(text);
        const cleaned = String(text).replace(/[^0-9+\-eE.,%]/g, '').replace(/%/g, '').trim();
        // Try to parse using the same normalization heuristic (comma/dot)
        let val = NaN;
        if (cleaned !== '') {
          // Prefer parseFloat on normalized string: convert comma decimal to dot when appropriate
          const lastComma = cleaned.lastIndexOf(',');
          const lastDot = cleaned.lastIndexOf('.');
          if (lastComma !== -1 && lastDot !== -1 && lastComma > lastDot) {
            val = Number(cleaned.replace(/\./g,'').replace(/,([^,]*)$/, '.$1'));
          } else {
            val = Number(cleaned.replace(/,/g, ''));
          }
        }

        if (typeof val === 'number' && isFinite(val)) {
          const out = val.toFixed(2);
          resultEl.textContent = hasPercent ? out + '%' : out;
        } else {
          // leave non-numeric text unchanged
          resultEl.textContent = text;
        }
      }

      const mo = new MutationObserver(muts => {
        for (const m of muts) {
          if (m.type === 'childList') {
            const newText = resultEl.textContent;
            if (newText && newText.length) formatAndSet(newText);
          }
        }
      });
      mo.observe(resultEl, { childList: true, characterData: true, subtree: true });

      // Also format initial content if any
      if (resultEl.textContent && resultEl.textContent.trim()) formatAndSet(resultEl.textContent.trim());
    })();
  </script>
</body>
</html>